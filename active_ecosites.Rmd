---
title: "active_ecosites"
author: "Nathan Roe"
date: "2/22/2022"
output: html_document
params:
  MLRA: 'placeholder'
  MLRA2: 'placeholer'
---

This script is designed to determine which ecosites are actively correlated to a soil component
(only major components and non-miscellaneous area components) in your MLRA. It builds off of Step 2
in the 'EDIT ecosite data' work flow (https://github.com/natearoe/EDIT_ecosite_data). 

You will need to make changes on lines 24 and 25 to define your MLRA of interest. If you are interested in a single MLRA, then lines 24 (MLRA) and 25 (MLRA2) can be set to identical values. If you are interested in two MLRAs, you can change line 25 (MLRA2) to the second MLRA of interest.

library
```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(stringr)
```

```{r}
MLRA <- "018"
MLRA2 <- "018"

pardir<- dirname(rstudioapi::getActiveDocumentContext()$path)
NASIS_report <- read.csv(paste(pardir, "/ecosite_report.csv", sep = ""))
```

only major components and non-miscellaneous areas
```{r}
NASIS_report_reduced <- NASIS_report %>% filter(majcompflag == "yes") %>% filter(compkind != "miscellaneous area")
```

which ecosites are active, and how many correlations are they associated with?
```{r}
ecosite_df <- as.data.frame(table(NASIS_report_reduced$ecosite_id)) %>% 
  rename(Ecosite = Var1, Count = Freq) %>% arrange(desc(Count))
ecosite_df
```

are components from your MLRA of interest correlated to ecosites from other MLRAs?
```{r}
ecosite_MLRAs <- unique(str_sub(ecosite_df$Ecosite, start = 2L, end = 4L))
ecosite_MLRAs
```

want to refine down to only a particular MLRA? I am interested in MLRA 018. Change the "018" portion according to your needs.
```{r}
MLRA18_ecosites <- ecosite_df$Ecosite[str_which(ecosite_df$Ecosite, paste("(?<=R|F{1})", MLRA, sep = ""))]
MLRA18_ecosites
```

interested in multiple MLRAs? Now I have defined MLRAs 018 and 022. I will continue the script using MLRA18_ecosites, not multiple_ecosites. If you 
are interested in multiple_MLRAs, you will need to find/replace MLRA18_ecosites for multiple_MLRAs below. 
```{r}
multiple_MLRAs <- ecosite_df$Ecosite[c(str_which(ecosite_df$Ecosite, paste("(?<=R|F{1})", MLRA, sep = "")), str_which(ecosite_df$Ecosite, paste("(?<=R|F{1})", MLRA2, sep = "")))]
```

create concatenation of ecosites for use in the next step of the 'EDIT ecosite data' workflow. 
```{r}
options(useFancyQuotes = FALSE)

ecosite_concat <- paste("c(", paste(sQuote(MLRA18_ecosites), collapse = ", "), ")")
ecosite_concat
```

This list of ecosites is going to be important in the 'EDIT ecosite data' process. You should select/copy the contacenated output from
c( to ). For example c('F018XC201CA', 'F018XI205CA', 'R018XI163CA'). You do not want the outer most quotation marks. 

Important: Perform QC on this list of ecosites. Sometimes, you might find that a component was correlated to two ecosites. This could result in something like, 'R018XI163CA & R018XD076CA'. These should be removed. Any other ecosites that are clearly erroneous should be removed as well. 
