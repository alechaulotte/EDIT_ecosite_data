---
title: "active_ecosites"
author: "Nathan Roe"
date: "2/22/2022"
output: html_document
---

This script is designed to determine which ecosites are actively correlated to a soil component
(only major components and non-miscellaneous area components) in your MLRA. It builds off of Step 2
in the 'EDIT ecosite data' work flow (https://github.com/natearoe/EDIT_ecosite_data). 

Note: You will need to change line 27 to the path where you saved your NASIS report from Step 2. 
The easiest way to do that is to find the file that you created in Step 2, your NASIS ecosite report. 
It should be in the folder with all your other 'EDIT ecosite data' files. Shift + right click > 
copy as path. Then paste the path in, replacing the existing one. That path will have backslashes \ 
these all need to be changed to forwardslashes /. 

Also, you will need to make changes on lines 50 and 57 (i.e., changing the MLRA of interest). 

library
```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(stringr)
```

```{r}
NASIS_report <- read.csv("C:/Users/Nathan.Roe/Documents/PES4ever/NASIS_data_for_EDIT.csv")
```

only major components and non-miscellaneous areas
```{r}
NASIS_report_reduced <- NASIS_report %>% filter(majcompflag == "yes") %>% filter(compkind != "miscellaneous area")
```

which ecosites are active, and how many correlations are they associated with?
```{r}
ecosite_df <- as.data.frame(table(NASIS_report_reduced$ecosite_id)) %>% 
  rename(Ecosite = Var1, Count = Freq) %>% arrange(desc(Count))
ecosite_df
```

are components from your MLRA of interest correlated to ecosites from other MLRAs?
```{r}
ecosite_MLRAs <- unique(str_sub(ecosite_df$Ecosite, start = 2L, end = 4L))
ecosite_MLRAs
```

want to refine down to only a particular MLRA? I am interested in MLRA 018. Change the "018" portion according to your needs.
```{r}
MLRA18_ecosites <- ecosite_df$Ecosite[str_which(ecosite_df$Ecosite, "(?<=R|F{1})018")]
MLRA18_ecosites
```

interested in multiple MLRAs? Now I have defined MLRAs 018 and 022. I will continue the script using MLRA18_ecosites, not multiple_ecosites. If you 
are interested in multiple_MLRAs, you will need to find/replace MLRA18_ecosites for multiple_MLRAs below. 
```{r}
multiple_MLRAs <- ecosite_df$Ecosite[c(str_which(ecosite_df$Ecosite, "(?<=R|F{1})018"), str_which(ecosite_df$Ecosite, "(?<=R|F{1})022"))]
```

create concatenation of ecosites for use in the next step of the 'EDIT ecosite data' workflow. 
```{r}
options(useFancyQuotes = FALSE)

ecosite_concat <- paste("c(", paste(sQuote(MLRA18_ecosites), collapse = ", "), ")")
ecosite_concat
```

This list of ecosites is going to be important in the 'EDIT ecosite data' process. You should select/copy the contacenated output from
c( to ). For example c('F018XC201CA', 'F018XI205CA', 'R018XI163CA'). You do not want the outer most quotation marks. 

Important: Perform QC on this list of ecosites. Sometimes, you might find that a component was correlated to two ecosites. This could result in something like, 'R018XI163CA & R018XD076CA'. These should be removed. Any other ecosites that are clearly erroneous should be removed as well. 